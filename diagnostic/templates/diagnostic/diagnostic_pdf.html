{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Thinking Diagnostic — Syllabus</title>

  {# PDF-only stylesheet (WeasyPrint will fetch it via base_url) #}
  <link rel="stylesheet" href="{% static 'css/pdf.css' %}">
</head>

<body>

  <div class="header">
    <img class="logo" src="{% static 'images/logo_tight.png' %}" alt="The School of Critical Thinking">

    <div class="header-right">
      <p class="kicker">Thinking Diagnostic</p>
      <h1 class="doc-title">Syllabus</h1>
      <p class="doc-meta">
        {% if full_name %}<strong>{{ full_name }}</strong>{% endif %}
        {% if organization %}{% if full_name %} · {% endif %}{{ organization }}{% endif %}
        {% if full_name or organization %} · {% endif %}
        {% now "F j, Y" %}
      </p>
    </div>
  </div>

  <p class="muted" style="margin: 0 0 7mm 0;">
    Start with the primary module. The secondary module removes the next constraint once you begin applying the first.
  </p>

  {% if selected_modules %}
    {% for m in selected_modules %}

      {# Force Secondary module onto a new page (i.e., module #2) #}
      {% if forloop.counter == 2 %}
        <div class="page-break"></div>
      {% endif %}

      <div class="module">
        <p class="kicker" style="margin:0 0 2mm 0;">
          {% if forloop.first %}Primary module{% else %}Secondary module{% endif %}
        </p>

        <h2>{{ m.title }}</h2>

        {% if m.goal %}
          <p class="muted" style="margin: 0 0 4mm 0;">{{ m.goal }}</p>
        {% endif %}

        <div class="spec">
          <p class="kicker" style="margin:0;">Module spec</p>
          <ul>
            {% if m.dimension %}<li><strong>Dimension:</strong> {{ m.dimension }}</li>{% endif %}
            {% if m.breakpoint %}<li><strong>Constraint:</strong> {{ m.breakpoint }}</li>{% endif %}
            {% if m.estimated_time %}<li><strong>Estimated time:</strong> {{ m.estimated_time }}</li>{% endif %}
          </ul>
        </div>

        {% if m.content_html %}
          <div>
            {{ m.content_html|safe }}
          </div>
        {% endif %}

        <div class="resources">
          <h3>Resources</h3>

          {% with r=m.resources %}
            {% if r.core_readings %}
              <h4>Core readings</h4>
              <ul>
                {% for item in r.core_readings %}
                  <li>
                    {% if item.link %}<a href="{{ item.link }}">{{ item.title }}</a>{% else %}{{ item.title }}{% endif %}
                    {% if item.author %}<span class="muted"> — {{ item.author }}</span>{% endif %}
                    {% if item.why %}<div class="why">{{ item.why }}</div>{% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

            {% if r.supporting %}
              <h4>Supporting</h4>
              <ul>
                {% for item in r.supporting %}
                  <li>
                    {% if item.link %}<a href="{{ item.link }}">{{ item.title }}</a>{% else %}{{ item.title }}{% endif %}
                    {% if item.author %}<span class="muted"> — {{ item.author }}</span>{% endif %}
                    {% if item.why %}<div class="why">{{ item.why }}</div>{% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

            {% if r.video %}
              <h4>Video</h4>
              <ul>
                {% for item in r.video %}
                  <li>
                    {% if item.link %}<a href="{{ item.link }}">{{ item.title }}</a>{% else %}{{ item.title }}{% endif %}
                    {% if item.author %}<span class="muted"> — {{ item.author }}</span>{% endif %}
                    {% if item.why %}<div class="why">{{ item.why }}</div>{% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

            {% if r.practice %}
              <h4>Practice</h4>
              <ul>
                {% for item in r.practice %}
                  <li>
                    {% if item.link %}<a href="{{ item.link }}">{{ item.title }}</a>{% else %}{{ item.title }}{% endif %}
                    {% if item.author %}<span class="muted"> — {{ item.author }}</span>{% endif %}
                    {% if item.why %}<div class="why">{{ item.why }}</div>{% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

            {% if not r.core_readings and not r.supporting and not r.video and not r.practice %}
              <p class="muted"><em>Resources for this module will be added soon.</em></p>
            {% endif %}
          {% endwith %}
        </div>
      </div>
    {% endfor %}
  {% endif %}

  {# --- Closing page (AFTER modules) --- #}
  {% if selected_modules %}
    <div class="page-break"></div>

    <div class="closing" style="margin-top: 10mm; max-width: 120mm;">
      <p class="kicker" style="margin:0 0 4mm 0;">Implementation</p>

      <h2 style="margin: 0 0 5mm 0; font-size: 14pt;">How to Use This Plan</h2>

      <p style="margin: 0 0 5mm 0;">
        This syllabus is designed for structured, independent work.
        Begin with the primary module. Apply one core idea immediately.
        Only then move to the secondary module.
      </p>

      <p style="margin: 0 0 5mm 0;">
        Do not try to absorb everything at once. The goal is calibration and execution, not information accumulation.
      </p>

      <hr style="margin: 8mm 0; border: none; border-top: 1pt solid rgba(0,0,0,0.25);">

      <p style="margin: 0 0 4mm 0;">
        If you want guided, individualized, or group implementation of this framework,
        structured programs are available through the School.
      </p>

      <p style="margin: 0;">
        Contact: <strong>schoolofcriticalthinking.org/contact</strong>
      </p>

      {# Avoid request.session access inside the template; keep it stable #}
      <p style="margin-top: 12mm; font-size: 9pt; color: rgba(0,0,0,0.55);">
        Thinking Diagnostic · Version v0_1
      </p>
    </div>
  {% endif %}

</body>
</html>